---
title: "tut_week_2_pdf"
author: "Boxuan Yi"
format: pdf
---

#### Preamble ####
Purpose: Read in data about Daily Shelter & Overnight Service Occupancy in Toronto 2023 to
make a graph of the average number of shelters used every month.
Author: Boxuan Yi
Email: boxuan.yi@mail.utoronto.ca
Date: 15 January 2024
Prerequisites: Know where to get data about the use of shelters in Toronto


```{r}
library(knitr)
library(janitor)
library(lubridate)
library(opendatatoronto)
library(tidyverse)
library(dplyr)
```


Acquire the dataset from opendatatoronto, and only use the 2023 dataset. 
Save it as "daily_shelters.csv"
```{r}
daily_shelters <-
  list_package_resources("21c83b32-d5a8-4106-a54f-010dbe49f6f2") |>
  filter(name == 
    "daily-shelter-overnight-service-occupancy-capacity-2023.csv") |>
  get_resource()

write_csv(
  x = daily_shelters,
  file = "daily_shelters.csv"
)

head(daily_shelters)
```


Clean the dataset and save it as "cleaned_toronto_shelters.csv"
```{r}
toronto_shelters_clean <-
  clean_names(daily_shelters)

write_csv(
  x = toronto_shelters_clean,
  file = "cleaned_toronto_shelters.csv"
)
head(toronto_shelters_clean)
```

Read the file
```{r}
toronto_shelters_clean <-
  read_csv(
    "cleaned_toronto_shelters.csv",
    show_col_types = FALSE
  )
```

Create a new column named occupancy_month based on the occupancy_date column. 
I used the full name of the month and its abbreviated name.
```{r}
toronto_shelters_clean <- toronto_shelters_clean |>
  mutate(occupancy_month = month(
    occupancy_date,
    label = TRUE,
    abbr = TRUE
  ))
head(toronto_shelters_clean)
```

1. Unique() gives a vector containing the unique values in the occupancy_month column. 
Use this to test if the months are correct. 
2. To see if all the corresponding dates start with "2023" 
```{r}
toronto_shelters_clean$occupancy_month |> unique()
all(substr(toronto_shelters_clean$occupancy_date, 1, 4) == "2023")
```

Only keep the relevant data. 
Create a new data frame called number_occupied classified by month, 
which is the mean of occupied_beds every month. 
For visualization, use ggplot to draw a 12-column bar plot 
with x-axis representing month and y-axis representing the average occupancy per night. 
```{r}
toronto_shelters_clean |>
  arrange(month(occupancy_date)) |> 
  drop_na(occupied_beds) |> 
  summarise(number_occupied = mean(occupied_beds),
            .by = occupancy_month) |> 
  ggplot(aes(x = occupancy_month, y = number_occupied)) +
  geom_bar(stat = "identity", fill = "yellow", color = "black") +
  labs(title = "Average Occupancy per night every month",
       x = "Occupancy Month",
       y = "Number Occupied") 
```

Again, only keep the data with useful information. 
Create a new data frame called number_occupied_sum classified by month, 
which is the total number of occupied_beds every month. 
Use ggplot to draw a 12-column bar plot for visualization. 
X represents month and Y represents the total number.
```{r}
toronto_shelters_clean |>
  arrange(month(occupancy_date)) |> 
  drop_na(occupied_beds) |> 
  summarise(number_occupied_sum = sum(occupied_beds),
            .by = occupancy_month) |> 
  ggplot(aes(x = occupancy_month, y = number_occupied_sum)) +
  geom_bar(stat = "identity", fill = "orange", color = "black") +
  labs(title = "Occupancy night every month",
       x = "Occupancy Month",
       y = "Total Number Occupied") 
```

